window.RPN=function(){function f(){}f.prototype.Generate=function(a){if("string"!==typeof a)throw Error("illegal arg type");var c=[],d=[[]],b=0,g=!0;do{a=a.replace(/^(\s|,)+/,"");if(0===a.length)break;d[b]=d[b]||[];var e=a.match(/(^0x[0-9a-f]+)|(^[0-9]+(\.[0-9]+)?)/i);if(null!=e)c.push(0===e[0].indexOf("0x")?parseInt(e[0],10):parseFloat(e[0])),a=a.substring(e[0].length),g=!1;else{var e=null,h;for(h in f.h)if(0===a.indexOf(h)){e=h;a=a.substring(h.length);break}if(null==e)throw Error("illegal expression:"+
a.substring(0,10)+" ...");switch(e){default:g&&("+"===e?e="#":"-"===e&&(e="_"));if(!(0===d[b].length||f.h[e].a>f.h[d[b][0]].a||f.h[e].a===f.h[d[b][0]].a&&"R"===f.h[e].f))for(;0<d[b].length&&(g=d[b].shift(),c.push(g),f.h[g].a>=f.h[e].a););d[b].unshift(e);g=!0;break;case "(":b++;g=!0;break;case ")":for(;0<d[b].length;)c.push(d[b].shift());if(0>--b)throw Error("too much ')'");g=!1}}}while(0<a.length);if(0<b)console.warn({message:"too much '('",i:a});else if(0<a.length)console.warn({message:"generate unifinished",
i:a});else{for(;0<d[b].length;)c.push(d[b].shift());return c.join(" ")}return null};f.prototype.Calculate=function(a){function c(a,b){if(""!=a)if(null!=f.h[a])b.push({value:a,b:f.h[a].b});else{for(var e in f.h){var d=a.indexOf(e);if(-1!=d){c(a.substring(0,d),b);c(a.substring(d,d+e.length),b);c(a.substring(d+e.length),b);return}}isNaN(a)?b.push({value:a,b:"str"}):b.push({value:a,b:"num"})}}if(!a||"string"!==typeof a)throw Error("illegal arg type");var d=[],b=0;for(a=a.split(/\s+|,/);b<a.length;b++)c(a[b],
d);for(a=[];0<d.length;)switch(b=d.shift(),b.b){case "num":a.push(-1!=b.value.indexOf("0x")?parseInt(b.value,10):parseFloat(b.value));break;case "str":a.push(b.value);break;case "state":console.warn("inclute statement:"+b.value);break;case "op":case "fn":var g=f.h[b.value];if(null==g)throw Error("not exist operate:"+b.value);for(var e=[],b=0;b<g.c;b++)if(0<a.length)e.unshift(a.pop());else throw Error("not enough operand");b=g.g.apply(null,e);null!=b&&a.push(b)}return 0<d.length||1!==a.length?(console.warn({message:"calculate unfinished",
j:d,l:a}),null):a[0]};f.h={"(":{a:20,b:"state",c:0,f:"",g:function(){}},")":{a:20,b:"state",c:0,f:"",g:function(){}},"#":{a:16,b:"op",c:1,f:"R",g:function(a){return a}},_:{a:16,b:"op",c:1,f:"R",g:function(a){return-a}},"~":{a:16,b:"op",c:1,f:"R",g:function(a){return~a}},"**":{a:15,b:"op",c:2,f:"R",g:function(a,c){return Math.pow(a,c)}},"*":{a:14,b:"op",c:2,f:"L",g:function(a,c){return a*c}},"/":{a:14,b:"op",c:2,f:"L",g:function(a,c){return a/c}},"%":{a:14,b:"op",c:2,f:"L",g:function(a,c){return a%
c}},"+":{a:13,b:"op",c:2,f:"L",g:function(a,c){return a+c}},"-":{a:13,b:"op",c:2,f:"L",g:function(a,c){return a-c}},"<<":{a:12,b:"op",c:2,f:"L",g:function(a,c){return a<<c}},">>":{a:12,b:"op",c:2,f:"L",g:function(a,c){return a>>c}},"&":{a:9,b:"op",c:2,f:"L",g:function(a,c){return a&c}},"^":{a:8,b:"op",c:2,f:"L",g:function(a,c){return a^c}},"|":{a:7,b:"op",c:2,f:"L",g:function(a,c){return a|c}}};f.prototype.SetOperate=function(a,c,d){f.h[a]={a:18,b:"fn",c:c,f:"L",g:d};return this};return f}();